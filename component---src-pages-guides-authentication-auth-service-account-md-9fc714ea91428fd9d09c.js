(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[70202],{48280:function(e,t,n){"use strict";n.r(t),n.d(t,{_frontmatter:function(){return p},default:function(){return d}});var a=n(22122),i=n(19756),s=(n(15007),n(64983)),r=n(99536),o=["components"],p={},c={_frontmatter:p},l=r.Z;function d(e){var t=e.components,n=(0,i.Z)(e,o);return(0,s.mdx)(l,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,s.mdx)("h1",{id:"service-account-jwt-bearer-grant"},"Service Account ","(","JWT Bearer",")"," Grant"),(0,s.mdx)("p",null,"This type of grant is great for server-to-server communication without transmitting any sensitive information."),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"104.375%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/cb523/oauth_flow_jwtassertion.webp 320w","/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/797b9/oauth_flow_jwtassertion.webp 640w","/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/4b075/oauth_flow_jwtassertion.webp 1280w","/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/15607/oauth_flow_jwtassertion.webp 1529w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/72799/oauth_flow_jwtassertion.png 320w","/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/6af66/oauth_flow_jwtassertion.png 640w","/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/21b4d/oauth_flow_jwtassertion.png 1280w","/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/fba00/oauth_flow_jwtassertion.png 1529w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/analytics-1.4-apis/static/26a8db46c9ca2b194c8de853f1c0bde8/21b4d/oauth_flow_jwtassertion.png",alt:"oauth flow jwtassertion",title:"oauth flow jwtassertion",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)("p",null,"Before you set up your OAuth client, make sure you"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"Have valid Adobe ID credentials."),(0,s.mdx)("li",{parentName:"ul"},"Have access to the Marketing Cloud"),(0,s.mdx)("li",{parentName:"ul"},"Are the Admin of one or more organizations.")),(0,s.mdx)("h2",{id:"step-1-link-your-analytics-account-to-your-adobe-id"},"Step 1: Link your Analytics account to your Adobe ID."),(0,s.mdx)("p",null,"Refer to ",(0,s.mdx)("a",{parentName:"p",href:"auth_link_account.md#"},"this section"),"."),(0,s.mdx)("h2",{id:"step-2-create-an-oauth-client"},"Step 2: Create an OAuth Client"),(0,s.mdx)("p",null,"Create an ",(0,s.mdx)("a",{parentName:"p",href:"auth_register_app.md#"},"OAuth client")," with your admin user. The client has to be configured with a Public Key."),(0,s.mdx)("h2",{id:"step-3-generate-the-json-web-token-jwt-with-a-private-key"},"Step 3: Generate the JSON Web Token ","(","JWT",")"," with a private key"),(0,s.mdx)("p",null,"Here is a sample script in PHP for generating a JWT Token:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre"},"/**\n * Generate a JWT\n *\n * @param $privateKey The private key filename or string literal to use to sign the token\n * @param $iss The issuer, usually the client_id\n * @param $sub The subject, usually a user_id\n * @param $aud The audience, usually the URI for the oauth server\n * @param $exp The expiration date. If the current time is greater than the exp, the JWT is invalid\n * @param $nbf The \"not before\" time. If the current time is less than the nbf, the JWT is invalid\n * @param $jti The \"jwt token identifier\", or nonce for this JWT\n *\n * @return string\n */\nfunction generate_jwt($privateKey, $iss, $sub, $aud, $exp = null, $nbf = null, $jti = null)\n{\n    if (file_exists($privateKey)) {\n        $privateKey = file_get_contents($privateKey);\n    }\n \n    $algo = 'RS256';\n\n\n    if (!$exp) {\n        $exp = time() + 1000;\n    }\n \n    $payload = array(\n        'iss' => $iss,\n        'sub' => $sub,\n        'aud' => $aud,\n        'exp' => $exp,\n        'iat' => time(),\n    );\n\n    if ($nbf) {\n        $payload['nbf'] = $nbf;\n    }\n\n    if ($jti) {\n        $payload['jti'] = $jti;\n    }\n\n    $header = array('typ' => 'JWT', 'alg' => $algo);\n\n    $find = array('+', '/', '\\r', '\\n', '=');\n    $replace = array('-', '_');\n\n    $segments = array(\n        str_replace($find, $replace, base64_encode(json_encode($header))),\n        str_replace($find, $replace, base64_encode(json_encode($payload))),\n    );\n\n    $signing_input = implode('.', $segments);\n\n    openssl_sign($signing_input, $signature, $privateKey, 'sha256');\n\n    $segments[] = str_replace($find, $replace, base64_encode($signature));\n\n    return implode('.', $segments);\n}\n")),(0,s.mdx)("p",null,"You can then call this function to output a JWT assertion:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre"},"// generate_jwt.php\n$jwt = generate_jwt($privateKey, 'TestClient', '001D49185195123B0A490D06@AdobeOrg', 'api.omniture.com');\necho $jwt\n \n// will output the following\neyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJUZXN0Q2xpZW50Iiwic3ViIjoiMDAxRDQ5MTg1MTk1MTIzQjBBNDkwRDA2QEFkb2JlT3JnIiwiYXVkIjoiYXBpLnZtMjIxLmRldi51dDEub21uaXR1cmUuY29tIiwiZXhwIjoxMzk1MzI4OTM2LCJpYXQiOjEzOTUzMjc5MzZ9.E3LzW6OTLx4vS35cF4bRAKVaRq0TQMfk0hpechmZVJy_FVnkc53VwuBl-4OIupbjgEWucV91hcYGXDr3leSZN48D9GC9MtezOpURZyJCL7ZoYNeyvaJpdZHo2yqhzC0Fgj1jSq1kYHdGy9wi_uwbITBF6Z0G2MR5iDSzosQxFNN5bmUZtk1QQps1NMKPgCZPfcjq05GuL5pM2gAPfc7h7R2_nod40y6Wp6IbT-ygXdfOPLefKpe1-p5lP7l9F49Nf3JCGoCOOOaJwJdzTauqtIItNbXQ86q4e5VaNLIlr8XWJhFEDAHBazMrfGBWLpt3_pu1pr_jzak4EuZZMtpfQQ\n")),(0,s.mdx)("h2",{id:"step-4-request-the-access-token"},"Step 4: Request the Access Token"),(0,s.mdx)("p",null,"Once the JWT is generated, make the request for the access token:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre"},'$ curl -v "https://api.vm474.dev.ut1.omniture.com/token" \\\n    -d "grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer"\\\n    -d "client_id=TestClient"\\\n    -d "assertion=$(php generate_jwt.php)"\n')),(0,s.mdx)("p",null,"If successful, the response will look similar to this:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre"},'{\n    "access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpZCI6ImM1MTI5NTEzNzk2ZjgwMmQwY2JhZGE2ZjdjZDJmYTlmODAwMjQyMWYiLCJjbGllbnRfaWQiOiJUZXN0Q2xpZW50IiwidXNlcl9pZCI6IjAwMUQ0OTE4NTE5NTEyM0IwQTQ5MEQwNkBBZG9iZU9yZyIsImV4cGlyZXMiOjEzOTA2MDgyNjEsInRva2VuX3R5cGUiOiJiZWFyZXIiLCJzY29wZSI6bnVsbH0.hSpfm_B3L9nxai9IjVukSnri8lQlEC2ohOOnRI7VHTyn6oubIn99RrMCYVfg7CcOmKaJWhtMCIBcFb4MDStK-JDW-koh9ZaLnJogGnXzKCtlCNvMWGLojRKW_dLVZU__GgXT7GTnIW02Z3YFlTmupglsuIuaxPCF7H6KPOAgvM_RVqo4UIGBQihKfwjbtCwiD5UvnE5-U2Eso8id4FNuWgmlE-cK7qAMwJW7B94QbYMGHNbKogKrgKNIhSVCIw5S68fH-vHjsxDceh1H1ZtbM8nDyPP_Bjg_a1VaIn7Q-hmHMEpSeDMUuLSPHsJbwEXQoJJkzJWMNLVHMnCzYIRJ0A",\n    "expires_in":3600,\n    "token_type":"bearer",\n    "scope":null,\n    "success":true\n}\n')),(0,s.mdx)("h2",{id:"step-5-authenticate-using-an-access-token"},"Step 5: Authenticate using an Access Token"),(0,s.mdx)("p",null,"Refer to ",(0,s.mdx)("a",{parentName:"p",href:"auth_tokens.md#"},"this section"),"."),(0,s.mdx)("p",null,(0,s.mdx)("strong",{parentName:"p"},"Parent topic:")," ",(0,s.mdx)("a",{parentName:"p",href:"auth_obtain_access_token.md"},"Obtain an Access Token")))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-authentication-auth-service-account-md-9fc714ea91428fd9d09c.js.map