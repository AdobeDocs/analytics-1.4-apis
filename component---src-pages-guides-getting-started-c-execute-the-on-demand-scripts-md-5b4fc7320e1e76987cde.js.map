{"version":3,"sources":["webpack://dev-site-documentation-template/./src/pages/guides/getting-started/c_Execute_the_On_Demand_scripts.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"qTAQaA,EAAe,GACtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGX,IAFFC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,eACE,GAAM,4EADR,+EAGA,mMAAoL,cAAGC,WAAW,IAC9L,KAAQ,mBADwK,iCAApL,gDAGA,oBACE,eAAIA,WAAW,MAAf,wBACA,eAAIA,WAAW,MAAf,uBACA,eAAIA,WAAW,MAAf,iEACA,eAAIA,WAAW,MAAf,uDACA,eAAIA,WAAW,MAAf,2DAEF,iEACA,eACE,GAAM,uBADR,wBAGA,qMACA,oBACE,eAAIA,WAAW,MAAf,gCACA,eAAIA,WAAW,MAAf,8CAEF,eACE,GAAM,gDADR,iDAGA,uLACA,oBACE,eAAIA,WAAW,OAAK,mBAAQA,WAAW,MAAnB,kBAApB,sDACE,eAAIA,WAAW,OACb,eAAIA,WAAW,MAAf,mFACA,eAAIA,WAAW,MAAf,gEACA,eAAIA,WAAW,MAAf,uDAGJ,eAAIA,WAAW,OAAK,mBAAQA,WAAW,MAAnB,eAApB,2EACA,eAAIA,WAAW,OAAK,mBAAQA,WAAW,MAAnB,qBAApB,0EAEF,sYACA,mBAAG,mBAAQA,WAAW,KAAnB,SAAH,QAAoD,mBAAQA,WAAW,KAAnB,gDAApD,kQACA,gJACA,eACE,GAAM,gEADR,iEAGA,iKACA,uFAAwE,mBAAQA,WAAW,KAAnB,kDAAxE,gDACA,mBAAG,mBAAQA,WAAW,KAAnB,SAAH,yJAAqM,cAAGA,WAAW,IAC/M,KAAQ,iDADyL,eAArM,oBAGA,eACE,GAAM,sDADR,uDAGA,+BAAgB,mBAAQA,WAAW,KAAnB,qBAAhB,gCAAqG,mBAAQA,WAAW,KAAnB,QAArG,4HAAyQ,mBAAQA,WAAW,KAAnB,eAAzQ,MACA,qBAAK,iBAAMA,WAAW,OAAjB,s0KA8IL,qBAAK,iBAAMA,WAAW,OAAjB,opHA8EL,qBAAK,iBAAMA,WAAW,OAAjB,05GA+DL,iPAAoO,mBAAQA,WAAW,KAAnB,qBAApO,oDACA,mBAAG,mBAAQA,WAAW,KAAnB,iBAAH,KAAyD,cAAGA,WAAW,IACnE,KAAQ,qEAD6C,iCAO7DJ,EAAWK,gBAAiB","file":"component---src-pages-guides-getting-started-c-execute-the-on-demand-scripts-md-5b4fc7320e1e76987cde.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/analytics-1.4-apis/analytics-1.4-apis/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"step-2-execute-the-on-demand-scripts-using-the-partnerrunscript-api-call\"\n    }}>{`Step 2: Execute the On Demand Scripts using the Partner.RunScript API Call`}</h1>\n    <p>{`In this section, you will create a function that sets all the parameters and retrieves the report data by executing the On Demand scripts you created in the first tutorial, `}<a parentName=\"p\" {...{\n        \"href\": \"c_scripting.md#\"\n      }}>{`1. On Demand Scripts Tutorial`}</a>{`. The code consists of five major sections:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Create the function`}</li>\n      <li parentName=\"ol\">{`Set the parameters`}</li>\n      <li parentName=\"ol\">{`Invoke the first On Demand script to create a report request`}</li>\n      <li parentName=\"ol\">{`Invoke the second On Demand script to check status`}</li>\n      <li parentName=\"ol\">{`Invoke the third On Demand script to pull report data`}</li>\n    </ol>\n    <p>{`The code follows the section explanations.`}</p>\n    <h2 {...{\n      \"id\": \"create-the-function\"\n    }}>{`Create the function`}</h2>\n    <p>{`The custom function that you will later place in the loop you created in Step 1 is getTwitterFollowersDataForDateRange`}{`(`}{`)`}{` and it accepts the following two parameters:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The integration ID instance`}</li>\n      <li parentName=\"ul\">{`The web service port type class instance`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"set-the-parameters-for-the-on-demand-scripts\"\n    }}>{`Set the parameters for the On Demand scripts`}</h2>\n    <p>{`In the function you will invoke three On Demand scripts. When you invoke an On Demand script, you will always provide the script name and the script parameters:`}</p>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Integration ID`}</strong>{` - The ID for the particular integration instance.`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`For PHP, you access the Integration ID directly from the integration instance.`}</li>\n          <li parentName=\"ul\">{`For Java, you use the method getIntegrationCode`}{`(`}{`)`}{`.`}</li>\n          <li parentName=\"ul\">{`For C`}{`#`}{`, you use the method integrationCode`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Script name`}</strong>{` - The name of the On Demand script to execute, set as a string value.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Script parameters`}</strong>{` - An array holding the parameters required by each specific script.`}</li>\n    </ul>\n    <p>{`In this JJ. Esquire Twitter demo application, the first script `}{`(`}{`create report request`}{`)`}{` requires the date range for the report so you will define myDateTo and myDateFrom parameters. The second `}{`(`}{`check status`}{`)`}{` and third `}{`(`}{`retrieve report data`}{`)`}{` scripts only require the Report ID, which is populated by the response of the first script.`}</p>\n    <p><strong parentName=\"p\">{`Note:`}</strong>{` In `}<strong parentName=\"p\">{`Create On Demand scripts to generate reports`}</strong>{` tutorial you defined parameters for these three scripts. You also defined replaceWith attributes, which are used to dynamcally reference parameter values. The script parameters you define in this function must include all of the replaceWith parameters.`}</p>\n    <p>{`The function code block shows the script name string and the script parameters array passed to each of the three scripts.`}</p>\n    <h2 {...{\n      \"id\": \"invoke-the-first-on-demand-script-to-create-a-report-request\"\n    }}>{`Invoke the first On Demand script to create a report request`}</h2>\n    <p>{`You use the Partner.RunScript method in the Data Connectors Partner API to run a On Demand script against a specific Customer integration.`}</p>\n    <p>{`In the code below, you first execute the On Demand script called `}<strong parentName=\"p\">{`followers`}{`_`}{`per`}{`_`}{`twitter`}{`_`}{`handle`}</strong>{` that creates a QueueRanked report request.`}</p>\n    <p><strong parentName=\"p\">{`Note:`}</strong>{` QueueRanked is a type of report that is based on one or more elements and one or more metrics. You can learn more about report types by reading the `}<a parentName=\"p\" {...{\n        \"href\": \"../reporting-api-1.3/methods/r_queueRanked.md\"\n      }}>{`QueueRanked`}</a>{` documentation.`}</p>\n    <h2 {...{\n      \"id\": \"invoke-the-second-on-demand-script-to-check-status\"\n    }}>{`Invoke the second On Demand script to check status`}</h2>\n    <p>{`Once the `}<strong parentName=\"p\">{`getReportStatusOD`}</strong>{` script returns a status of `}<strong parentName=\"p\">{`done`}</strong>{`, you then use the Partner.RunScript method a third time to retrieve the data for the report using the On Demand script `}<strong parentName=\"p\">{`getReportOD`}</strong>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`PHP Code\n \n<?php   \n/**\n* Get reportId for Twitter followers data for date range\n*\n* @integrationId  The integration identifier\n* @soapApp           Instance of the Data ConnectorsSoapApp\n*/\nfunction getTwitterFollowersDataForDateRange($integrationId , $soapApp){\n \n/**************  Set the parameters  *********************/\n \n    /* Define the parameters for the RunScript SOAP request */\n    $wsdlType = \"integration\"; // Use Data Connectors Integration WSDL\n    $functionName = \"Partner.RunScript\";\n    $params = array( \n            'integrationCode' => $integrationId,  // integration identifier\n            'scriptName' => \"followers_per_twitter_handle\", // the script name for the On Demand script\n            /* define the scriptParameters defined in the On Demand script */\n            'scriptParameters' => array(\n                         array('name' => 'myDateFrom', 'value' => '2010-01-11'),\n                         array('name' => 'myDateTo', 'value' => '2011-01-17')      \n                  )\n    );\n    $debug = 0;\n \n \n/******** Invoke the first On Demand script **************/\n   \n    /* Call the Partner.RunScript method to execute the followers_per_twitter_handle (On demand script) */\n    $result = $soapApp->sendRequest($functionName, $params, $wsdlType, $debug);\n   \n    if (is_array($result) && array_key_exists('faultstring', $result)) {\n       echo \"\\\\nError-RunScript: \" . $result['faultstring'] . \"\\\\n\";\n       $result = false;\n    } else {\n       echo \"The report has been queued. Report ID: \" . $result[0]['result'][0]['reportID'] . \"\\\\n\";\n       $reportId = $result[0]['result'][0]['reportID'];\n       $result = waitForReport($reportId, $integrationId, $soapApp, \"true\");\n    }\n    return $result;      \n}\n \n     /*********** Invoke the second On Demand script ***********/\n \n/**\n* Wait for the report to be processed.\n*\n* @reportId          The id of the report in the queue\n* @integrationId  The integration identifier\n* @soapApp           Instance of the Data ConnectorsSoapApp\n* @showOutput      Show the echo statements provided or not   \n* @iterations      The maximum number of iteration to wait\n* @seconds      The number of seconds between each iteration   \n*/\nfunction waitForReport($reportId, $integrationId, $soapApp, $showOutput=false, $iterations=5, $seconds=15)\n{\n    $count = 0;\n    $status = \"\";\n    while ($count < $iterations) {\n       /* Define the parameters for the RunScript SOAP request */\n       $wsdlType = \"integration\"; // Use Data Connectors Integration WSDL\n       $functionName = \"Partner.RunScript\";\n       $params = array( \n            'integrationCode' => $integrationId, \n                  'scriptName' => \"getReportStatusOD\", // the script name for the On Demand script\n                  'scriptParameters' => array(\n                  array('name' => 'REPORT_ID', 'value' => $reportId)\n                  )\n       );\n       $debug = 0;\n       \n       /* Call the Partner.RunScript method to execute the getReportOD (On demand script) */\n       $result = $soapApp->sendRequest($functionName, $params, $wsdlType, $debug);\n \nif (is_array($result) && array_key_exists('faultstring', $result)) {\n             echo \"\\\\nError-RunScript: \" . $result['faultstring'] . \"\\\\n\";\n       } else {\n             $status = $result[0]['result'][0]['status'] . \"\\\\n\";\n       }\n       \n       if (trim($status) == \"done\"){\n             if ($showOutput) {\n                   echo \"The report is ready.\\\\n\\\\n\";\n             }\n             return $reportId;\n       } else {\n             if ($showOutput) {\n                   echo \"The report is not ready.  Waiting \" . $seconds . \" seconds to retry.\\\\n\";\n             }\n             $count++;\n             sleep($seconds);\n       }\n    }\n    echo \"The report was not found!\\\\n\";\n    return false;\n}\n \n     /*********** Invoke the third On Demand script ***********/\n \n/**\n*\n* Get the report for the given reportId\n*\n* @reportId          The id of the report in the queue\n* @integrationId  The integration identifier\n* @soapApp           Instance of the Data ConnectorsSoapApp\n* @showOutput      Show the echo statements provided or not   \n*/\nfunction getReport($reportId, $integrationId, $soapApp, $showOutput=false)\n{\n    /* Define the parameters for the RunScript SOAP request */\n    $wsdlType = \"integration\"; // Use Data Connectors Integration WSDL\n    $functionName = \"Partner.RunScript\";\n    $params = array( \n            'integrationCode' => $integrationId, \n            'scriptName' => \"getReportOD\", // the script name for the On Demand script\n            'scriptParameters' => array(\n                         array('name' => 'REPORT_ID', 'value' => $reportId)\n                        )\n    );\n    $debug = 0;\n       \n    /* Call the Partner.RunScript method to execute the getReportOD (On demand script) */\n    $result = $soapApp->sendRequest($functionName, $params, $wsdlType, $debug);\n       \n    if (is_array($result)) {\n       if ( array_key_exists('faultstring', $result)) {\n             if ($showOutput) {\n                   echo \"\\\\nError-RunScript: \" . $result['faultstring'] . \"\\\\n\";\n             }\n             return false;\n       } else {\n             return $result[0]['result'][0]['report'];\n       }\n    }\n    return false;\n}\n \n?>\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{}}>{`Java Code\n \nprivate Report getTwitterFollowersDataForDateRange(IntegrationDetail integrationDetail, Data ConnectorsIntegrationWebServicePortType genesisIntegrationWebServicePortType) throws RemoteException, InterruptedException\n    {\n \n/**************  Set the parameters  *********************/\n      /* Script name that you defined in the integration\n         wizard */\n      String scriptName = \"followers_per_twitter_handle\";\n     \n      /* Initialize the ScriptParameter array */\n      ScriptParameter[] scriptParameters = new\n                                      ScriptParameter[2];\n      scriptParameters[0] = new ScriptParameter();\n      scriptParameters[1] = new ScriptParameter();\n \n      /* myDateFrom is the parameter you defined in the On\n         Demand script */\n        scriptParameters[0].setName(\"myDateFrom\");\n      /* Set the value for the myDateFrom parameter to be\n         passed to the script */\n        scriptParameters[0].setValue(\"2010-1-11\");\n      /* myDateTo is the parameter you defined in the On\n         Demand script */\n        scriptParameters[1].setName(\"myDateTo\");\n      /* Set the value for the myDateTo parameter to be\n         passed to the script */\n        scriptParameters[1].setValue(\"2011-1-17\");\n \n        /* Validate the script parameters */\n        ScriptParameter[] scriptParametersValidate = new\n                                      ScriptParameter[1];\n        scriptParametersValidate[0] = new ScriptParameter();\n        scriptParametersValidate[0].setName(\"REPORT_ID\");\n \n \n/******** Invoke the first On Demand script **************/\n \n        /* Call the Partner.RunScript method to execute the\n           followers_per_twitter_handle (On demand script)\n           with appropriate arguments */\n        ScriptResult[] scriptResult =\ngenesisIntegrationWebServicePortType.partnerRunScript(integrationDetail.getIntegrationCode(), scriptName, scriptParameters);\n      \n       /* Retreive the response and store it in\n          reportQueueResponse */\n        ReportQueueResponse reportQueueResponse = (ReportQueueResponse) scriptResult[0].getResult()[0];\n      /* Store the report ID from the response in the\n         scriptParametersValidate array */\nscriptParametersValidate[0].setValue(reportQueueResponse.getReportID());\n \n     /*********** Invoke the second On Demand script ***********/\n       \n      /* Call the Partner.RunScript method to execute the\n         getReportStatusOD (On demand script) with appropriate\n         arguments */\n        scriptResult = genesisIntegrationWebServicePortType.partnerRunScript(integrationDetail.getIntegrationCode(), \"getReportStatusOD\", scriptParametersValidate);\n      /* Loop till the response does not return the status of\n         done */\n        while (!((ReportResponse) scriptResult[0].getResult()[0]).getStatus().equalsIgnoreCase(\"done\"))\n        {\n            scriptResult = genesisIntegrationWebServicePortType.partnerRunScript(integrationDetail.getIntegrationCode(), \"getReportStatusOD\", scriptParametersValidate);\n            Thread.sleep(2000);\n        }\n \n     /*********** Invoke the third On Demand script ***********/\n \n       /* Check if the status returns done, and if yes, invoke the getReportOD script to return data */\n            if(((Report_status)\nscriptResult[0].getResult()[0]).getStatus().equalsIgnoreCase(\"done\"))\n          {\n              scriptResult = genesisIntegrationWebServicePortType.partnerRunScript(integrationDetail.getIntegrationCode(), \"getReportOD\", scriptParametersValidate);\n          }\n \n      /* Return the report data */\n        return ((ReportResponse) scriptResult[0].getResult()[0]).getReport();\n    }\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{}}>{`C# Code\n \n public static report getTwitterFollowersDataForDateRange(integrationDetail partnerIntegrationDetail, Data ConnectorsIntegrationWebServicePortTypeClient genesisIntegrationWebServicePortTypeClient)\n    {\n \n/**************  Set the parameters  *********************/\n \n       /* Script name that you defined in the integration wizard */\n      String scriptName = \"followers_per_twitter_handle\";\n     \n       /* Initialize the ScriptParameter array */\n        scriptParameter[] scriptParameters = new scriptParameter[2];\n        scriptParameters[0] = new scriptParameter();\n        scriptParameters[1] = new scriptParameter();\n \n       /* myDateFrom is the parameter you defined in the On Demand script */\n        scriptParameters[0].name = \"myDateFrom\";\n       /* Set the value for the myDateFrom parameter to be passed to the script */\n        scriptParameters[0].value = \"2010-1-11\";\n      /* myDateTo is the parameter you defined in the On Demand script */\n        scriptParameters[1].name = \"myDateTo\";\n     /* Set the value for the myDateTo parameter to be passed to the script */\n        scriptParameters[1].value = \"2011-1-17\";\n \n        /* Validate the script parameters */\n        scriptParameter[] scriptParametersValidate = new scriptParameter[1];\n        scriptParametersValidate[0] = new scriptParameter();\n        scriptParametersValidate[0].name = \"REPORT_ID\";\n \n/******** Invoke the first On Demand script **************/\n \n       /* Call the Partner.RunScript method to execute the followers_per_twitter_handle (On demand script) with appropriate arguments */\n        scriptResult[] scriptResult = genesisIntegrationWebServicePortTypeClient.PartnerRunScript(partnerIntegrationDetail.integrationCode, scriptName, scriptParameters);\n       \n        /* Retreive the response and store it in reportQueueResponse */\n        reportQueueResponse reportQueueResponse = (reportQueueResponse) scriptResult[0].result[0];\n      /* Store the report ID from the response in the scriptParametersValidate array */\n        scriptParametersValidate[0].value = reportQueueResponse.reportID;\n \n     /*********** Invoke the second On Demand script ***********/\n  \n        /* Call the Partner.RunScript method to execute the getReportStatusOD (On demand script) with appropriate arguments */\n        scriptResult = genesisIntegrationWebServicePortTypeClient.PartnerRunScript(partnerIntegrationDetail.integrationCode, \"getReportStatusOD\", scriptParametersValidate);\n        /* Loop till the response does not return the status of done */\n        while (!((reportResponse) scriptResult[0].result[0]).status.Equals(\"done\"))\n        {\n            scriptResult = genesisIntegrationWebServicePortTypeClient.PartnerRunScript(partnerIntegrationDetail.integrationCode, \"getReportStatusOD\", scriptParametersValidate);\n            Thread.Sleep(2000);\n        }\n    \n      /*********** Invoke the third On Demand script ***********/\n \n        /* Check if the status returns done, and if yes, invoke the getReportOD script to return data */\n        if (((report_status)\nscriptResult[0].result[0]).status.Equals(\"done\"))\n        {\n            scriptResult = genesisIntegrationWebServicePortTypeClient.PartnerRunScript(partnerIntegrationDetail.integrationCode, \"getReportOD\", scriptParametersValidate);\n        }\n \n        /* Return the report data */\n        return ((reportResponse) scriptResult[0].result[0]).report;\n    }\n`}</code></pre>\n    <p>{`The queue ranked report request, from the first On Demand script execution, returns a report ID in the response. Once the report has been queued, you then use the report ID to invoke the second On Demand script `}{`(`}{` `}<strong parentName=\"p\">{`getReportStatusOD`}</strong>{` `}{`)`}{` for checking the status of the report.`}</p>\n    <p><strong parentName=\"p\">{`Parent topic:`}</strong>{` `}<a parentName=\"p\" {...{\n        \"href\": \"c_Create_Data_Connectors_Partner_Reports_using_the_Partner_API.md\"\n      }}>{`4. Partner Reports Tutorial`}</a></p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}